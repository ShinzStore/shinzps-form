<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Personal Shopper ShinZ v0.2</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 0;
      color: #333;
    }
    header {
      background: #007bff;
      color: white;
      padding: 1rem;
      text-align: center;
    }
    main {
      padding: 1rem;
    }
    h2 {
      margin-top: 1.5rem;
      color: #007bff;
    }
    .section {
      background: #fff;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    label, input, select, textarea, button {
      display: block;
      width: 100%;
      margin-top: 0.5rem;
    }
    input[type="text"], input[type="tel"], textarea, select {
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .produk-item {
      margin-bottom: 0.5rem;
    }
    .produk-item label {
      font-weight: bold;
      cursor: pointer;
    }
    .produk-item small {
      display: block;
      margin-left: 1.5rem;
      color: #555;
    }
    .inline {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .inline > * {
      flex: 1;
    }
    .ringkasan {
      background: #fff7e6;
      border-left: 5px solid orange;
      padding: 1rem;
      margin-top: 1rem;
    }
    .ringkasan ul {
      padding-left: 1.2rem;
    }
    button {
      background: #28a745;
      color: white;
      border: none;
      padding: 0.75rem;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 1rem;
    }
    button:hover {
      background: #218838;
    }
    .hidden {
      display: none;
    }
    .order-summary {
      background: #e2e3e5;
      padding: 1rem;
      border-radius: 8px;
      margin-top: 1rem;
    }
    .order-summary h3 {
      margin-top: 0;
    }
    .upload-section {
      margin-top: 1rem;
    }
    .status-section {
      margin-top: 1rem;
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    a.whatsapp-link {
      display: inline-block;
      margin-top: 0.5rem;
      background: #25D366;
      color: white;
      padding: 0.5rem 1rem;
      text-decoration: none;
      border-radius: 4px;
    }
    a.whatsapp-link:hover {
      background: #1DA851;
    }
  </style>
</head>
<body>

  <header>
    <h1>Personal Shopper ShinZ v0.2</h1>
    <p>Isi borang di bawah untuk buat tempahan</p>
  </header>

  <main>
    <!-- 1. Pilihan Produk -->
    <section class="section" id="menu-produk">
      <h2>1. Pilihan Produk</h2>
      <div class="subsection">
        <h3>TGV PROJEK IRIS</h3>
        <div class="produk-item">
          <input type="checkbox" id="irisAli" data-type="irisAli" onchange="hitungRingkasan()" />
          <label for="irisAli">Iris Ejen Ali ‚Äì RM70 / box</label>
          <div class="inline hidden" id="irisAli-opts">
            <div>
              <label>Kuantiti (box):</label>
              <input type="number" id="irisAli-kuantiti" min="1" value="1" onchange="hitungRingkasan()" />
            </div>
            <div>
              <label>Upah PS Iris:</label>
              <select id="irisAli-upah" onchange="hitungRingkasan()">
                <option value="25">RM25 (Ekonomi)</option>
                <option value="30">RM30 (Standard)</option>
              </select>
            </div>
          </div>
        </div>
        <div class="produk-item">
          <input type="checkbox" id="irisAlicia" data-type="irisAlicia" onchange="hitungRingkasan()" />
          <label for="irisAlicia">Iris Ejen Alicia ‚Äì RM70 / box</label>
          <div class="inline hidden" id="irisAlicia-opts">
            <div>
              <label>Kuantiti (box):</label>
              <input type="number" id="irisAlicia-kuantiti" min="1" value="1" onchange="hitungRingkasan()" />
            </div>
            <div>
              <label>Upah PS Iris:</label>
              <select id="irisAlicia-upah" onchange="hitungRingkasan()">
                <option value="25">RM25 (Ekonomi)</option>
                <option value="30">RM30 (Standard)</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      <div class="subsection">
        <h3>TGV KAD ID EJEN</h3>
        <div class="produk-item">
          <input type="checkbox" id="kadAli" data-type="kadAli" onchange="hitungRingkasan()" />
          <label for="kadAli">Kad ID Ejen Ali ‚Äì RM11.50 / Kad (Bermula 22/5/2025)</label>
          <div class="inline hidden" id="kadAli-opts">
            <div>
              <label>Kuantiti (unit):</label>
              <input type="number" id="kadAli-kuantiti" min="1" value="1" onchange="hitungRingkasan()" />
            </div>
            <div>
              <label>Upah PS:</label>
              <input type="number" id="kadAli-upah" value="3.5" readonly />
            </div>
          </div>
        </div>
        <div class="produk-item">
          <input type="checkbox" id="kadSatria" data-type="kadSatria" onchange="hitungRingkasan()" />
          <label for="kadSatria">Kad ID Ejen Satria ‚Äì RM19.00 / eCombo (Bermula 24/5/2025)</label>
          <div class="inline hidden" id="kadSatria-opts">
            <div>
              <label>Kuantiti (eCombo):</label>
              <input type="number" id="kadSatria-kuantiti" min="1" value="1" onchange="hitungRingkasan()" />
            </div>
            <div>
              <label>Upah PS:</label>
              <input type="number" id="kadSatria-upah" value="6" readonly />
            </div>
            <div>
              <p style="font-size:0.9rem; margin-top:0.5rem; margin-left:0.5rem;">
                ‚≠ê Free Gift (Popcorn + Air) ‚Äì tidak dihantar.
              </p>
            </div>
          </div>
        </div>
        <div class="produk-item">
          <input type="checkbox" id="kadAlicia" data-type="kadAlicia" onchange="hitungRingkasan()" />
          <label for="kadAlicia">Kad ID Ejen Alicia ‚Äì RM11.50 / Kad (Bermula 29/5/2025)</label>
          <div class="inline hidden" id="kadAlicia-opts">
            <div>
              <label>Kuantiti (unit):</label>
              <input type="number" id="kadAlicia-kuantiti" min="1" value="1" onchange="hitungRingkasan()" />
            </div>
            <div>
              <label>Upah PS:</label>
              <input type="number" id="kadAlicia-upah" value="3.5" readonly />
            </div>
            <div>
              <label>Add On Mini Shield (RM2/pcs):</label>
              <input type="checkbox" id="kadAlicia-shield" value="2" onchange="hitungRingkasan()" />
            </div>
          </div>
        </div>
      </div>
      <div class="subsection">
        <h3>TGV KAD KECEMASAN KELUANGMAN</h3>
        <div class="produk-item">
          <input type="checkbox" id="kadKM" data-type="kadKM" onchange="hitungRingkasan()" />
          <label for="kadKM">Kad Kecemasan Keluang Man ‚Äì RM11.50 / Kad (Bermula 31/5/2025)</label>
          <div class="inline hidden" id="kadKM-opts">
            <div>
              <label>Kuantiti (unit):</label>
              <input type="number" id="kadKM-kuantiti" min="1" value="1" onchange="hitungRingkasan()" />
            </div>
            <div>
              <label>Upah PS:</label>
              <input type="number" id="kadKM-upah" value="3.5" readonly />
            </div>
            <div>
              <label>Add On Mini Shield (RM2/pcs):</label>
              <input type="checkbox" id="kadKM-shield" value="2" onchange="hitungRingkasan()" />
            </div>
          </div>
        </div>
      </div>
      <div class="ringkasan" id="ringkasan-produk">
        <strong>Ringkasan Pilihan Produk:</strong>
        <div id="list-produk">Tiada produk dipilih.</div>
      </div>
    </section>

    <!-- 2. Semak Keluar -->
    <section class="section" id="menu-checkout">
      <h2>2. Semak Keluar</h2>
      <form id="checkoutForm" onsubmit="return buatPesanan()">
        <div class="inline">
          <div>
            <label>Nama Penuh:</label>
            <input type="text" id="namaPelanggan" required />
          </div>
          <div>
            <label>Nombor Telefon:</label>
            <input type="tel" id="telefonPelanggan" required placeholder="e.g. 01170351789" />
          </div>
        </div>
        <div>
          <label>Alamat Penghantaran:</label>
          <textarea id="alamatPelanggan" rows="3" required></textarea>
        </div>
        <div>
          <h3>Perlindungan Pembungkusan</h3>
          <p>(Hanya untuk item Iris sahaja)</p>
          <label>Bilangan Lapisan Wrap (RM1/box Iris, Kad auto 1 lapis percuma):</label>
          <input type="number" id="wrapCount" min="0" value="0" onchange="hitungRingkasan()" />
          <p style="font-size:0.9rem; color:#555;">
            *Kad ID Ejen (Alicia / Ali / Satria / Keluang Man) mendapat 1 lapis wrap percuma.
          </p>
        </div>
        <div>
          <h3>Pilihan Penghantaran:</h3>
          <select id="shippingOption" onchange="hitungRingkasan()" required>
            <option value="" disabled selected>-- Pilih Satu --</option>
            <option value="posKad">Pos Semenanjung Malaysia (Kad) ‚Äì RM7</option>
            <option value="posIris">Pos Semenanjung Malaysia (Projek Iris) ‚Äì RM10</option>
            <option value="cod">COD berdekatan Guar Chempedak (Caj ikut jarak)</option>
            <option value="pickup">Pickup Guar Utama Guar Chempedak (Percuma)</option>
          </select>
        </div>
        <div id="codDistanceDiv" class="hidden">
          <label>Caj COD (RM per km):</label>
          <input type="number" id="codDistance" min="0" value="0" placeholder="Contoh: 5 (km)" onchange="hitungRingkasan()" />
        </div>
        <div>
          <h3>Cara Bayaran:</h3>
          <p>Gunakan QR DuitNow berikut:</p>
          <img src="https://via.placeholder.com/200x100?text=QR+DuitNow" alt="QR DuitNow" style="display:block; margin:0.5rem auto; width:200px;" />
        </div>
        <div class="ringkasan" id="ringkasan-checkout">
          <strong>Ringkasan Harga:</strong>
          <div id="checkout-details">Sila semak pilihan di atas.</div>
        </div>
        <button type="submit">Membuat Pesanan</button>
      </form>
    </section>

    <!-- 3. Paparan Selepas Pesanan -->
    <section id="orderResult" class="hidden">
      <div class="order-summary">
        <h3>Terima Kasih! Pesanan anda telah diterima.</h3>
        <p>Order ID anda ialah: <strong id="orderID"></strong></p>
        <p>Total yang perlu dibayar: <strong id="orderTotal"></strong></p>
        <p>Untuk pertanyaan, klik WhatsApp saya:</p>
        <a class="whatsapp-link" href="#" id="waLink" target="_blank">Chat WhatsApp: 01170351789</a>
      </div>
      <div class="upload-section">
        <h3>Upload Resit Pembayaran:</h3>
        <input type="file" id="uploadResit" accept="image/*,application/pdf" />
        <p style="font-size:0.9rem; color:#555;">
          *Saya akan semak terus melalui pautan di Google Sheets nanti.*
        </p>
      </div>
      <div class="status-section">
        <h3>Status Pesanan Anda:</h3>
        <p><em>Sila tunggu admin kemaskini status (contoh: ‚ÄúDiproses‚Äù, ‚ÄúDihantar‚Äù).</em></p>
      </div>
    </section>
  </main>

  <script>
    const PRODUCTS = {
      irisAli:    { label: 'Iris Ejen Ali',    price: 70, upahBase: 25 },
      irisAlicia: { label: 'Iris Ejen Alicia', price: 70, upahBase: 25 },
      kadAli:     { label: 'Kad ID Ejen Ali',  price: 11.5, upahBase: 3.5 },
      kadSatria:  { label: 'Kad ID Ejen Satria', price: 19, upahBase: 6 },
      kadAlicia:  { label: 'Kad ID Ejen Alicia', price: 11.5, upahBase: 3.5 },
      kadKM:      { label: 'Kad Kecemasan Keluang Man', price: 11.5, upahBase: 3.5 }
    };

    function toggleVisibility(id, show) {
      document.getElementById(id).classList.toggle('hidden', !show);
    }

    function hitungRingkasan() {
      const listElem = document.getElementById('list-produk');
      let items = [];
      let totalBarang = 0;
      let totalUpah   = 0;

      ['irisAli','irisAlicia'].forEach(key => {
        const checkbox = document.getElementById(key);
        const optsId   = key + '-opts';
        if (checkbox.checked) {
          toggleVisibility(optsId, true);
          const kuantiti = parseInt(document.getElementById(key + '-kuantiti').value) || 1;
          const upahVal  = parseFloat(document.getElementById(key + '-upah').value);
          items.push({
            kode: key,
            label: PRODUCTS[key].label,
            price: PRODUCTS[key].price,
            kuantiti: kuantiti
          });
          totalBarang += PRODUCTS[key].price * kuantiti;
          totalUpah   += upahVal * kuantiti;
        } else {
          toggleVisibility(optsId, false);
        }
      });

      if (document.getElementById('kadAli').checked) {
        toggleVisibility('kadAli-opts', true);
        const kuantiti = parseInt(document.getElementById('kadAli-kuantiti').value) || 1;
        totalBarang += PRODUCTS.kadAli.price * kuantiti;
        totalUpah   += PRODUCTS.kadAli.upahBase * kuantiti;
        items.push({ kode: 'kadAli', label: PRODUCTS.kadAli.label, price: PRODUCTS.kadAli.price, kuantiti });
      } else {
        toggleVisibility('kadAli-opts', false);
      }

      if (document.getElementById('kadSatria').checked) {
        toggleVisibility('kadSatria-opts', true);
        const kuantiti = parseInt(document.getElementById('kadSatria-kuantiti').value) || 1;
        totalBarang += PRODUCTS.kadSatria.price * kuantiti;
        totalUpah   += PRODUCTS.kadSatria.upahBase * kuantiti;
        items.push({ kode: 'kadSatria', label: PRODUCTS.kadSatria.label, price: PRODUCTS.kadSatria.price, kuantiti, freeGift: true });
      } else {
        toggleVisibility('kadSatria-opts', false);
      }

      if (document.getElementById('kadAlicia').checked) {
        toggleVisibility('kadAlicia-opts', true);
        const kuantiti = parseInt(document.getElementById('kadAlicia-kuantiti').value) || 1;
        const shield   = document.getElementById('kadAlicia-shield').checked ? 2 : 0;
        totalBarang += PRODUCTS.kadAlicia.price * kuantiti;
        totalUpah   += (PRODUCTS.kadAlicia.upahBase + shield) * kuantiti;
        items.push({ kode: 'kadAlicia', label: PRODUCTS.kadAlicia.label, price: PRODUCTS.kadAlicia.price, kuantiti, addShield: shield>0 });
      } else {
        toggleVisibility('kadAlicia-opts', false);
      }

      if (document.getElementById('kadKM').checked) {
        toggleVisibility('kadKM-opts', true);
        const kuantiti = parseInt(document.getElementById('kadKM-kuantiti').value) || 1;
        const shield   = document.getElementById('kadKM-shield').checked ? 2 : 0;
        totalBarang += PRODUCTS.kadKM.price * kuantiti;
        totalUpah   += (PRODUCTS.kadKM.upahBase + shield) * kuantiti;
        items.push({ kode: 'kadKM', label: PRODUCTS.kadKM.label, price: PRODUCTS.kadKM.price, kuantiti, addShield: shield>0 });
      } else {
        toggleVisibility('kadKM-opts', false);
      }

      if (items.length) {
        let listHTML = '<ul>';
        items.forEach(item => {
          let line = `<li>${item.label} x ${item.kuantiti} (RM${(item.price*item.kuantiti).toFixed(2)})</li>`;
          if (item.freeGift) {
            line += `<li style="margin-left:1rem; color:#555;"><em>üéÅ Free Gift untuk ${item.label}</em></li>`;
          }
          if (item.addShield) {
            line += `<li style="margin-left:1rem; color:#555;"><em>+ Mini Shield (RM2 x ${item.kuantiti})</em></li>`;
          }
          listHTML += line;
        });
        listHTML += '</ul>';
        listElem.innerHTML = listHTML;
      } else {
        listElem.innerHTML = 'Tiada produk dipilih.';
      }

      window.currentOrder = {
        items,
        subtotalBarang: totalBarang,
        subtotalUpah: totalUpah,
        subtotalWrap: 0,
        subtotalPos: 0,
        total: 0
      };
    }

    function hitungRingkasan() {
      if (!window.currentOrder) {
        document.getElementById('checkout-details').innerText = 'Sila pilih sekurang-kurangnya satu produk di atas.';
        return;
      }
      let { subtotalBarang, subtotalUpah } = window.currentOrder;
      let subtotalWrap = 0;
      let subtotalPos = 0;
      const wrapCount = parseInt(document.getElementById('wrapCount').value) || 0;
      subtotalWrap = wrapCount * 1;

      const shippingOpt = document.getElementById('shippingOption').value;
      let totalBoxIris = 0;
      ['irisAli-kuantiti','irisAlicia-kuantiti'].forEach(id => {
        const val = parseInt(document.getElementById(id)?.value) || 0;
        if (val) totalBoxIris += val;
      });
      if (shippingOpt === 'posKad') {
        subtotalPos = 7;
      } else if (shippingOpt === 'posIris') {
        subtotalPos = 10;
        if (totalBoxIris > 1) subtotalPos = 10 * totalBoxIris;
      } else if (shippingOpt === 'cod') {
        const km = parseFloat(document.getElementById('codDistance').value) || 0;
        subtotalPos = km;
      } else if (shippingOpt === 'pickup') {
        subtotalPos = 0;
      }
      toggleVisibility('codDistanceDiv', shippingOpt === 'cod');
      window.currentOrder.subtotalWrap = subtotalWrap;
      window.currentOrder.subtotalPos  = subtotalPos;
      const totalAll = subtotalBarang + subtotalUpah + subtotalWrap + subtotalPos;
      window.currentOrder.total = totalAll;
      let html = `
        <ul>
          <li>Subtotal Barang: RM${subtotalBarang.toFixed(2)}</li>
          <li>Subtotal Upah: RM${subtotalUpah.toFixed(2)}</li>
          <li>Subtotal Wrap: RM${subtotalWrap.toFixed(2)}</li>
          <li>Subtotal Penghantaran: RM${subtotalPos.toFixed(2)}</li>
        </ul>
        <p><strong>Total Keseluruhan: RM${totalAll.toFixed(2)}</strong></p>
      `;
      document.getElementById('checkout-details').innerHTML = html;
    }

    function generateOrderID() {
      const now = new Date();
      const YYYY = now.getFullYear();
      const MM   = String(now.getMonth()+1).padStart(2, '0');
      const DD   = String(now.getDate()).padStart(2, '0');
      const hh   = String(now.getHours()).padStart(2, '0');
      const mm   = String(now.getMinutes()).padStart(2, '0');
      const ss   = String(now.getSeconds()).padStart(2, '0');
      const rnd  = String(Math.floor(Math.random()*9000) + 1000);
      return `PS-${YYYY}${MM}${DD}-${hh}${mm}${ss}-${rnd}`;
    }

    function buatPesanan() {
      const nama   = document.getElementById('namaPelanggan').value.trim();
      const tel    = document.getElementById('telefonPelanggan').value.trim();
      const alamat = document.getElementById('alamatPelanggan').value.trim();
      if (!nama || !tel || !alamat) {
        alert('Sila lengkapkan maklumat pelanggan.');
        return false;
      }
      if (!window.currentOrder) {
        alert('Sila pilih sekurang-kurangnya satu produk.');
        return false;
      }
      const orderID = generateOrderID();
      const total   = window.currentOrder.total.toFixed(2);
      document.getElementById('orderID').innerText = orderID;
      document.getElementById('orderTotal').innerText = `RM${total}`;
      const waMsg = encodeURIComponent(
        `Assalamualaikum, saya ${nama}.\nOrder ID: ${orderID}\nJumlah Bayaran: RM${total}\nSila semak dan bantu uruskan. Terima kasih.`
      );
      document.getElementById('waLink').href = `https://wa.me/601170351789?text=${waMsg}`;
      document.getElementById('menu-produk').classList.add('hidden');
      document.getElementById('menu-checkout').classList.add('hidden');
      document.getElementById('orderResult').classList.remove('hidden');
      // Placeholder: send to Google Sheets via fetch to Sheet.best or Apps Script
      return false;
    }

    ['irisAli','irisAlicia','kadAli','kadSatria','kadAlicia','kadKM'].forEach(id => {
      document.getElementById(id).addEventListener('change', hitungRingkasan);
    });
    document.getElementById('wrapCount').addEventListener('change', hitungRingkasan);
    document.getElementById('shippingOption').addEventListener('change', hitungRingkasan);
    document.getElementById('codDistance').addEventListener('input', hitungRingkasan);
    document.getElementById('kadAlicia-shield').addEventListener('change', hitungRingkasan);
    document.getElementById('kadKM-shield').addEventListener('change', hitungRingkasan);
    hitungRingkasan();
  </script>
</body>
</html>
